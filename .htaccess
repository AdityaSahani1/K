# Apache configuration for SnapSera
RewriteEngine On

# Security: Block direct access to sensitive files
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Security: Protect database configuration
<FilesMatch "database\.php">
    Require all denied
</FilesMatch>

# Security: Protect migration and schema files
<FilesMatch "(migrate\.php|schema\.sql)">
    Require all denied
</FilesMatch>

# Serve existing files (PHP, HTML, CSS, JS, images, fonts) directly
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Serve existing directories directly
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Default directory index
DirectoryIndex index.php index.html

# Enable CORS for API requests
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    Header always set Access-Control-Max-Age "3600"
</IfModule>

# Disable caching for dynamic content (PHP, HTML, JS, CSS)
<FilesMatch "\.(html|php|js|css)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Enable caching for static assets
<FilesMatch "\.(jpg|jpeg|png|gif|ico|svg|webp|woff|woff2|ttf|eot)$">
    Header set Cache-Control "public, max-age=31536000"
</FilesMatch>

# Enable error logging
php_flag display_errors Off
php_flag log_errors On

# Disable directory browsing
Options -Indexes

# Protect against clickjacking
Header always set X-Frame-Options "SAMEORIGIN"

# Enable XSS protection
Header always set X-XSS-Protection "1; mode=block"

# Prevent MIME sniffing
Header always set X-Content-Type-Options "nosniff"
